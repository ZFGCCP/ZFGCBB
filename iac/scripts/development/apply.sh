#!/bin/bash
set -e

PROJECT_DIR=$1
PROJECT_ENVIRONMENT=$2

SCRIPT_DIR=$(dirname "$0")
source "$SCRIPT_DIR/../common/check-minikube.sh"
source "$SCRIPT_DIR/../common/check-project-dir.sh"

check_project_dir "$PROJECT_DIR" "$PROJECT_ENVIRONMENT"
check_minikube

cd "$PROJECT_DIR/environments/$PROJECT_ENVIRONMENT"

kubectl kustomize . -v 9
echo ""
echo "Press any key to continue..."
read -n 1 -s
clear

#kustomize edit fix

echo "
           █████████████████████████████████████████████████████            █████████               
           █████████████████████████████████████████████████████            █████████               
       ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█████████████▓▓▓▓████               
       ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█████████████▓▓▓▓████               
       ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█████████████▓▓▓▓████               
           ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████               
           ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████               
               █████▓▓▓▓▓▓▓▓▓▓▓▓████░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████               
               █████▓▓▓▓▓▓▓▓▓▓▓▓████░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████               
                   █████▓▓▓▓▓▓▓▓████░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████               
                   █████▓▓▓▓▓▓▓▓████░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████               
                        ████▓▓▓▓████░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████           
                        ████▓▓▓▓████░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████           
                        ████▓▓▓▓████░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████           
                   █████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓            ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████           
                   █████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓            ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████           
               █████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                    ▒▓▓▓▓▓▓▓▓▓▓▓▓████           
               █████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                    ▒▓▓▓▓▓▓▓▓▓▓▓▓████           
           ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                ████▓▓▓▓▒    ████               
           ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                ████▓▓▓▓▒    ████               
       █████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                ████▓▓▓▓▒    ████               
       █████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                ████▓▓▓▓▒    ████               
                        ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓            ████░   ▒████████████           
                        ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓            ████░   ▒████████████           
                        ████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓            ████░   ▒████████████           
                   █████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░            ░░░░░░░░░░░░░████               
                   █████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░            ░░░░░░░░░░░░░████               
               █████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░████               
               █████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░████               
           █████████████████████████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒████                   
           █████████████████████████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒████                   
                                        ████░░░░█████████████████████████████████                   
                                        ████░░░░█████████████████████████████████                   
                                        ████░░░░█████████████████████████████████                   
                                    ████░░░░████████▓▓▓▓░░░░░░░░░░░░█████████████████               
                                    ████░░░░████████▓▓▓▓░░░░░░░░░░░░█████████████████               
                                ████░░░░████        ████░░░░░░░░░░░░████░        ████               
                                ████░░░░████        ████░░░░░░░░░░░░████░        ████               
                                ████████                ████░░░░░░░░████░        ████               
                                ████████                ████░░░░░░░░████░        ████               
                                    ████                ████████░░░░████░   ▒████                   
                                    ████                ████████░░░░████░   ▒████                   
                                        ████        ████████▓▓▓▓█████████████████                   
                                        ████        ████████▓▓▓▓█████████████████                   
                                        ████        ████████▓▓▓▓█████████████████                   
                                            ████████▓▓▓▓████████████                                
                                            ████████▓▓▓▓████████████                                
                                            ████████▓▓▓▓████▓▓▓▓▓▓▓▓█████████                       
                                            ████████▓▓▓▓████▓▓▓▓▓▓▓▓█████████                       
                                        ████████▓▓▓▓▓▓▓▓████████▓▓▓▓▓▓▓▓░   ▒████████               
                                        ████████▓▓▓▓▓▓▓▓████████▓▓▓▓▓▓▓▓░   ▒████████               
                                        ████▓▓▓▓▓▓▓▓▓▓▓▓    ▓▓▓▓████████▓▓▓▓▓▓▓▓▓▓▓▓▓████           
                                        ████▓▓▓▓▓▓▓▓▓▓▓▓    ▓▓▓▓████████▓▓▓▓▓▓▓▓▓▓▓▓▓████           
                                        ████▓▓▓▓▓▓▓▓▓▓▓▓    ▓▓▓▓████████▓▓▓▓▓▓▓▓▓▓▓▓▓████           
                                        ████▓▓▓▓▓▓▓▓    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█████▓▓▓▓▓▓▓▓▓▓▓▓████       
                                        ████▓▓▓▓▓▓▓▓    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█████▓▓▓▓▓▓▓▓▓▓▓▓████       
                                        █████████████████████████████████████████████████████       
                                        █████████████████████████████████████████████████████       
                                                                                                    
"

echo "Applying kustomize build..."


kustomize build . | kubectl apply -f -
cd -

echo "Deployments have been applied."